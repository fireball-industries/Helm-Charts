# Node-RED - Flow-Based Programming ğŸ”´

*Because wiring diagrams ARE code, and we're not apologizing for it.*

## Overview

Deploy production-ready Node-RED instances with persistent storage, authentication, and WebSocket support. Perfect for IoT automation, system integration, and low-code application development.

Node-RED is a flow-based development tool for visual programming, originally developed by IBM for wiring together hardware devices, APIs, and online services. It provides a browser-based editor that makes it easy to wire together flows using the wide range of nodes in the palette.

**Brought to you by Fireball Industries** - Where visual programming meets k3s excellence, and coffee consumption meets concerning levels.

## Features

### Core Capabilities
- ğŸ¨ **Visual Flow Editor** - Drag-and-drop programming with 200+ built-in nodes
- ğŸ’¾ **Persistent Storage** - Flows survive pod restarts (unlike your willpower at 3am)
- ğŸ”’ **Authentication** - Bcrypt-hashed passwords, because security matters
- ğŸ“Š **Project Support** - Git integration for version-controlled flows
- ğŸ”Œ **Extensive Node Library** - MQTT, HTTP, databases, timers, and more
- ğŸŒ **WebSocket Support** - Real-time bidirectional communication
- ğŸš€ **Multi-Tenant Ready** - Deploy isolated instances per customer/project

### Deployment Features
- ğŸ¯ **Resource Presets** - Small/Medium/Large configurations
- ğŸ”§ **Flexible Services** - LoadBalancer, NodePort, or Ingress
- ğŸ“ˆ **Health Checks** - Automatic restart on failure
- ğŸ” **Security Hardened** - Non-root user, dropped capabilities
- ğŸ·ï¸ **Rancher Integration** - Full wizard support

## Quick Deploy

### Via Rancher UI (Easiest)
1. **Apps & Marketplace** â†’ **Charts** â†’ Search "Node-RED"
2. Click **Install** and configure:
   - **Namespace**: `node-red` (or customer-specific)
   - **Version**: `3.1.0` (latest stable)
   - **Authentication**: Enabled with auto-generated password
   - **Resources**: Medium (250m CPU, 512Mi RAM)
   - **Storage**: 5Gi persistent volume
   - **Service**: LoadBalancer (k3s default)
3. Click **Install** and wait 30-60 seconds
4. Get credentials from Secrets â†’ `node-red-auth`
5. Access via LoadBalancer IP on port 1880

### Via Helm CLI
```bash
# Quick deploy with defaults
helm install my-nodered fireball/node-red

# Custom deployment
helm install acme-corp fireball/node-red \
  --set namespace.name=nodered-acme \
  --set persistence.size=10Gi \
  --set nodeRed.resources.preset=large
```

## Access Your Instance

After deployment, find the URL:

```bash
# Get LoadBalancer IP
kubectl get svc -n node-red
# Access: http://<EXTERNAL-IP>:1880

# Get credentials
kubectl get secret -n node-red node-red-auth -o jsonpath='{.data.username}' | base64 --decode  # admin
kubectl get secret -n node-red node-red-auth -o jsonpath='{.data.password}' | base64 --decode  # <auto-generated>
```

## Configuration Examples

### Development Setup
```yaml
namespace:
  name: nodered-dev

nodeRed:
  resources:
    preset: small  # 100m CPU, 256Mi RAM
  
persistence:
  size: 2Gi

service:
  type: NodePort
  nodePort: 30180

nodeRed:
  auth:
    password: "admin"  # Simple password for dev
```

### Production Setup
```yaml
namespace:
  name: nodered-prod

nodeRed:
  image:
    tag: "3.1.0"
  resources:
    preset: large  # 500m CPU, 1Gi RAM
  auth:
    enabled: true
    # Leave password empty for auto-generation

persistence:
  enabled: true
  size: 20Gi
  storageClass: "longhorn"

service:
  type: LoadBalancer

ingress:
  enabled: true
  className: "nginx"
  hosts:
    - host: node-red.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: node-red-tls
      hosts:
        - node-red.example.com
```

### Multi-Tenant Setup
```yaml
# Deploy separate instances per customer
# Customer 1: ACME Corp
helm install acme fireball/node-red \
  --set namespace.name=nodered-acme \
  --set nodeRed.settings.custom.editorTheme.header.title="ACME Corp Automation"

# Customer 2: Globex
helm install globex fireball/node-red \
  --set namespace.name=nodered-globex \
  --set nodeRed.settings.custom.editorTheme.header.title="Globex Integration Hub"
```

## Common Use Cases

### IoT Device Integration
Perfect for:
- MQTT broker connections
- Modbus/OPC-UA industrial protocols
- Sensor data collection and processing
- Real-time dashboards with node-red-dashboard

### System Integration
Automate workflows between:
- REST APIs
- Databases (MySQL, PostgreSQL, MongoDB)
- Message queues (MQTT, AMQP, Kafka)
- Cloud services (AWS, Azure, Google Cloud)

### Home Automation
- Smart home device control
- Webhook integrations
- Scheduled automation
- Voice assistant integrations

### Data Processing
- ETL pipelines
- Data transformation
- Webhook receivers
- Scheduled jobs

## Resource Sizing Guide

| Preset | CPU | Memory | Storage | Use Case |
|--------|-----|--------|---------|----------|
| **Small** | 100m-500m | 256Mi-1Gi | 2Gi | Dev/testing, simple flows |
| **Medium** | 250m-1000m | 512Mi-2Gi | 5Gi | Production, typical IoT |
| **Large** | 500m-2000m | 1Gi-4Gi | 20Gi | Heavy processing, many flows |

## Troubleshooting

### Can't Access Node-RED
```bash
# Check if pod is running
kubectl get pods -n node-red

# Check service
kubectl get svc -n node-red

# View logs
kubectl logs -n node-red -l app=node-red
```

### Forgot Password
```bash
# Retrieve auto-generated password
kubectl get secret -n node-red node-red-auth -o jsonpath='{.data.password}' | base64 --decode
echo

# Or reset by upgrading with new password
helm upgrade my-nodered fireball/node-red \
  --set nodeRed.auth.password="newpassword" \
  --reuse-values
```

### Flows Not Saving
```bash
# Check PVC is bound
kubectl get pvc -n node-red

# Check disk space
kubectl exec -n node-red deployment/node-red -- df -h /data

# Verify permissions
kubectl exec -n node-red deployment/node-red -- ls -la /data
```

### Need More Resources
```bash
# Upgrade to larger preset
helm upgrade my-nodered fireball/node-red \
  --set nodeRed.resources.preset=large \
  --reuse-values

# Or use custom resources
helm upgrade my-nodered fireball/node-red \
  --set nodeRed.resources.preset=custom \
  --set nodeRed.resources.custom.requests.cpu=1000m \
  --set nodeRed.resources.custom.limits.memory=4Gi \
  --reuse-values
```

## Backup & Restore

### Backup Flows
```bash
# Create backup
kubectl exec -n node-red deployment/node-red -- \
  tar czf /tmp/backup.tar.gz /data/flows.json /data/.config.json

# Copy to local machine
kubectl cp node-red/$(kubectl get pod -n node-red -l app=node-red -o jsonpath='{.items[0].metadata.name}'):/tmp/backup.tar.gz \
  ./node-red-backup-$(date +%F).tar.gz
```

### Restore Flows
```bash
# Upload backup
kubectl cp ./node-red-backup.tar.gz \
  node-red/$(kubectl get pod -n node-red -l app=node-red -o jsonpath='{.items[0].metadata.name}'):/tmp/restore.tar.gz

# Extract
kubectl exec -n node-red deployment/node-red -- \
  tar xzf /tmp/restore.tar.gz -C /

# Restart Node-RED
kubectl rollout restart deployment/node-red -n node-red
```

## Persistence

When persistence is **enabled** (default):
- âœ… Flows survive pod restarts
- âœ… Installed nodes persist
- âœ… Credentials preserved (encrypted)
- âœ… Projects saved
- âœ… Configuration maintained

When persistence is **disabled**:
- âŒ All data lost on pod restart
- âŒ NOT recommended for production
- âš ï¸ Only use for testing/demos

## Security Notes

âœ… **What's Secure:**
- Authentication enabled by default (bcrypt hashed passwords)
- Non-root user (UID 1000)
- Capabilities dropped
- Namespace isolation
- Session affinity for WebSocket security

âš ï¸ **What You Should Do:**
- Use strong passwords (auto-generated is good!)
- Enable ingress with TLS for HTTPS
- Use network policies to restrict access
- Disable function external modules if untrusted users
- Keep Node-RED version updated

## Support & Documentation

- **Full Documentation**: [README.md](README.md) in this chart
- **Node-RED Docs**: [nodered.org/docs](https://nodered.org/docs/)
- **Helm Chart Repo**: [github.com/fireball-industries/helm-charts](https://github.com/fireball-industries/helm-charts)
- **Issues**: [GitHub Issues](https://github.com/fireball-industries/helm-charts/issues)
- **Commercial Support**: support@fireballindustries.com

## What Makes This Different

Unlike basic Node-RED deployments, this chart provides:
- ğŸ¯ **Production-ready** - Not just a demo, actually works in production
- ğŸ”’ **Secure by default** - Authentication, security contexts, resource limits
- ğŸ’¾ **Data persistence** - Your flows don't vanish into the void
- ğŸš€ **Multi-tenant** - Deploy as many instances as you need
- ğŸ¨ **Rancher integrated** - Click-to-deploy wizards, not YAML hell
- ğŸ“Š **Resource management** - Presets that make sense, not guesswork
- ğŸ”§ **Battle-tested** - Used by Fireball Industries customers since 2024

## Quick Reference

```bash
# Deploy
helm install my-nodered fireball/node-red

# Get URL
kubectl get svc -n node-red

# Get credentials
kubectl get secret -n node-red node-red-auth -o jsonpath='{.data.password}' | base64 --decode

# View logs
kubectl logs -f -n node-red -l app=node-red

# Restart
kubectl rollout restart deployment/node-red -n node-red

# Upgrade
helm upgrade my-nodered fireball/node-red --reuse-values

# Uninstall
helm uninstall my-nodered -n node-red
```

---

**Fireball Industries** - *We Play With Fire So You Don't Have Toâ„¢*

Visual programming meets k3s. Wiring diagrams as infrastructure. Coffee as a service.

*Because sometimes the best code is the code you draw.* ğŸ¨ğŸ”¥
