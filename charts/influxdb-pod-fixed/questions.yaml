# ============================================================================
# Rancher Questions UI Configuration - InfluxDB Pod
# Fireball Industries - "Ignite Your Factory Efficiency"â„¢
# ============================================================================
# This file provides the interactive form in Rancher's Apps & Marketplace
# for your multi-tenant customers to configure their InfluxDB deployments.
# ============================================================================

categories:
- Database
- Monitoring
- Industrial

questions:
# ============================================================================
# Deployment Configuration
# ============================================================================
- variable: deploymentMode
  label: Deployment Mode
  description: "Single instance for edge/dev or HA clustering for production factories"
  type: enum
  default: single
  required: true
  group: "Deployment"
  options:
    - "single"
    - "ha"
  show_subquestion_if: "ha"
  subquestions:
    - variable: replicaCount
      label: Number of Replicas
      description: "HA mode requires 3+ replicas for quorum"
      type: int
      default: 3
      min: 3
      max: 7

- variable: resourcePreset
  label: Resource Preset
  description: "Pre-configured resource profiles based on sensor count"
  type: enum
  default: medium
  required: true
  group: "Deployment"
  options:
    - "edge"
    - "small"
    - "medium"
    - "large"
    - "xlarge"
    - "custom"
  show_subquestion_if: "custom"
  subquestions:
    - variable: resources.requests.cpu
      label: CPU Request
      description: "Minimum CPU allocation"
      type: string
      default: "1000m"
    - variable: resources.requests.memory
      label: Memory Request
      description: "Minimum memory allocation"
      type: string
      default: "2Gi"
    - variable: resources.limits.cpu
      label: CPU Limit
      description: "Maximum CPU allocation"
      type: string
      default: "2000m"
    - variable: resources.limits.memory
      label: Memory Limit
      description: "Maximum memory allocation"
      type: string
      default: "4Gi"

# ============================================================================
# InfluxDB Configuration
# ============================================================================
- variable: influxdb.organization
  label: Organization Name
  description: "Your factory/company name for InfluxDB organization"
  type: string
  default: "factory"
  required: true
  group: "InfluxDB Configuration"

- variable: influxdb.bucket
  label: Default Bucket Name
  description: "Primary bucket for sensor data collection"
  type: string
  default: "sensors"
  required: true
  group: "InfluxDB Configuration"

- variable: influxdb.retention
  label: Data Retention Period
  description: "How long to keep data (e.g., 7d, 30d, 90d, 365d, inf)"
  type: string
  default: "90d"
  required: true
  group: "InfluxDB Configuration"

- variable: influxdb.adminToken
  label: Admin Token
  description: "Initial admin token. Leave empty to auto-generate (recommended). Store securely!"
  type: password
  group: "InfluxDB Configuration"

- variable: influxdb.adminUser
  label: Admin Username
  description: "Username for InfluxDB UI login"
  type: string
  default: "admin"
  required: true
  group: "InfluxDB Configuration"

- variable: influxdb.adminPassword
  label: Admin Password
  description: "Password for UI login. Leave empty to auto-generate."
  type: password
  group: "InfluxDB Configuration"

# ============================================================================
# Storage Configuration
# ============================================================================
- variable: persistence.enabled
  label: Enable Persistent Storage
  description: "REQUIRED for production. InfluxDB needs persistent storage for data."
  type: boolean
  default: true
  required: true
  group: "Storage"
  show_subquestion_if: true
  subquestions:
    - variable: persistence.storageClass
      label: Storage Class
      description: "Storage class for PVC. Leave empty for default."
      type: storageclass
    - variable: persistence.size
      label: Storage Size
      description: "Persistent volume size (controlled by resourcePreset unless custom)"
      type: string
      default: "50Gi"
    - variable: persistence.accessMode
      label: Access Mode
      description: "PVC access mode"
      type: enum
      default: "ReadWriteOnce"
      options:
        - "ReadWriteOnce"
        - "ReadWriteMany"

# ============================================================================
# Network Configuration
# ============================================================================
- variable: service.type
  label: Service Type
  description: "Kubernetes service type for InfluxDB access"
  type: enum
  default: "ClusterIP"
  required: true
  group: "Network"
  options:
    - "ClusterIP"
    - "NodePort"
    - "LoadBalancer"
  show_subquestion_if: "NodePort"
  subquestions:
    - variable: service.nodePort
      label: Node Port
      description: "Specific node port (30000-32767)"
      type: int
      min: 30000
      max: 32767

- variable: ingress.enabled
  label: Enable Ingress
  description: "Expose InfluxDB via Ingress controller"
  type: boolean
  default: false
  group: "Network"
  show_subquestion_if: true
  subquestions:
    - variable: ingress.className
      label: Ingress Class
      description: "Ingress controller class (e.g., nginx, traefik)"
      type: string
      default: "nginx"
    - variable: ingress.host
      label: Hostname
      description: "Hostname for InfluxDB access (e.g., influxdb.yourdomain.com)"
      type: hostname
      required: true
    - variable: ingress.tls.enabled
      label: Enable TLS
      description: "Enable HTTPS with TLS certificate"
      type: boolean
      default: false
      show_subquestion_if: true
      subquestions:
        - variable: ingress.tls.secretName
          label: TLS Secret Name
          description: "Name of secret containing TLS certificate"
          type: string

# ============================================================================
# Industrial Features
# ============================================================================
- variable: industrial.bucketsEnabled
  label: Enable Industrial Buckets
  description: "Pre-configure buckets for SCADA, production, energy, and quality data"
  type: boolean
  default: true
  group: "Industrial Features"

- variable: industrial.telegrafIntegration
  label: Enable Telegraf Integration
  description: "Configure for Telegraf agents (OPC UA, Modbus, MQTT)"
  type: boolean
  default: false
  group: "Industrial Features"

- variable: industrial.grafanaIntegration
  label: Enable Grafana Integration
  description: "Auto-configure datasource for Grafana dashboards"
  type: boolean
  default: false
  group: "Industrial Features"

# ============================================================================
# High Availability Options
# ============================================================================
- variable: backup.enabled
  label: Enable Automated Backups
  description: "Schedule automatic backups via CronJob"
  type: boolean
  default: false
  group: "High Availability"
  show_if: "deploymentMode=ha"
  show_subquestion_if: true
  subquestions:
    - variable: backup.schedule
      label: Backup Schedule
      description: "Cron schedule for backups (e.g., '0 2 * * *' for 2 AM daily)"
      type: string
      default: "0 2 * * *"
    - variable: backup.retention
      label: Backup Retention
      description: "Number of backups to retain"
      type: int
      default: 7
      min: 1
    - variable: backup.storageClass
      label: Backup Storage Class
      description: "Storage class for backup PVCs"
      type: storageclass

- variable: podDisruptionBudget.enabled
  label: Enable Pod Disruption Budget
  description: "Ensure minimum replicas during cluster maintenance"
  type: boolean
  default: false
  group: "High Availability"
  show_if: "deploymentMode=ha"

# ============================================================================
# Security
# ============================================================================
- variable: security.podSecurityPolicy.enabled
  label: Enable Pod Security Policy
  description: "Apply pod security standards"
  type: boolean
  default: true
  group: "Security"

- variable: networkPolicy.enabled
  label: Enable Network Policy
  description: "Restrict network traffic to InfluxDB pod"
  type: boolean
  default: false
  group: "Security"
  show_subquestion_if: true
  subquestions:
    - variable: networkPolicy.allowedNamespaces
      label: Allowed Namespaces
      description: "Comma-separated list of namespaces that can access InfluxDB"
      type: string

- variable: rbac.enabled
  label: Enable RBAC
  description: "Create ServiceAccount with appropriate permissions"
  type: boolean
  default: true
  group: "Security"

# ============================================================================
# Monitoring
# ============================================================================
- variable: monitoring.serviceMonitor.enabled
  label: Enable Prometheus ServiceMonitor
  description: "Monitor InfluxDB metrics with Prometheus"
  type: boolean
  default: false
  group: "Monitoring"
  show_subquestion_if: true
  subquestions:
    - variable: monitoring.serviceMonitor.interval
      label: Scrape Interval
      description: "Prometheus scrape interval"
      type: string
      default: "30s"

# ============================================================================
# Advanced Configuration
# ============================================================================
- variable: influxdb.logLevel
  label: Log Level
  description: "InfluxDB logging verbosity"
  type: enum
  default: "info"
  group: "Advanced"
  options:
    - "debug"
    - "info"
    - "warn"
    - "error"

- variable: nodeSelector
  label: Node Selector
  description: "Node labels for pod assignment (JSON format: {\"key\":\"value\"})"
  type: string
  group: "Advanced"

- variable: tolerations
  label: Tolerations
  description: "Pod tolerations (JSON array format)"
  type: string
  group: "Advanced"

- variable: affinity
  label: Affinity Rules
  description: "Pod affinity/anti-affinity rules (JSON format)"
  type: string
  group: "Advanced"
