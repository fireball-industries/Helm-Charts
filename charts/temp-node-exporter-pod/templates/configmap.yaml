apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "node-exporter.fullname" . }}
  namespace: {{ include "node-exporter.namespace" . }}
  labels:
    {{- include "node-exporter.labels" . | nindent 4 }}
data:
  node-exporter.yaml: |
    # Node Exporter Configuration
    # Generated by Helm Chart
    
    # Deployment Mode: {{ .Values.deploymentMode }}
    # Resource Preset: {{ .Values.resourcePreset }}
    
    collectors:
      {{- $preset := .Values.resourcePreset -}}
      {{- if and (ne $preset "custom") (hasKey .Values.resourcePresets $preset) }}
      enabled: {{ (index .Values.resourcePresets $preset).collectors | toJson }}
      {{- else }}
      enabled: {{ .Values.collectors.enabled | toJson }}
      {{- end }}
      
      optional:
        systemd: {{ .Values.collectors.optional.systemd }}
        processes: {{ .Values.collectors.optional.processes }}
        textfile: {{ .Values.collectors.optional.textfile }}
        ntp: {{ .Values.collectors.optional.ntp }}
        tcpstat: {{ .Values.collectors.optional.tcpstat }}
        interrupts: {{ .Values.collectors.optional.interrupts }}
        thermal_zone: {{ .Values.collectors.optional.thermal_zone }}
        ethtool: {{ .Values.collectors.optional.ethtool }}
        wifi: {{ .Values.collectors.optional.wifi }}
        rapl: {{ .Values.collectors.optional.rapl }}
        supervisord: {{ .Values.collectors.optional.supervisord }}
    
    {{- if .Values.collectors.optional.textfile }}
    textfile:
      directory: {{ .Values.collectors.collectorArgs.textfile.directory }}
    {{- end }}
    
    web:
      listen-address: {{ .Values.listenAddress }}
      telemetry-path: {{ .Values.metricsPath }}
    
    # Edge optimizations
    edge:
      temperatureMonitoring: {{ .Values.edge.temperatureMonitoring }}
      diskWearMonitoring: {{ .Values.edge.diskWearMonitoring }}
      minimalMode: {{ .Values.edge.minimalMode }}
