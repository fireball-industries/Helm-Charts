# ============================================================================
# Traefik Ingress Controller Helm Chart - Default Values
# ============================================================================
# Fireball Industries - Patrick Ryan
# "Because your factory's API gateway shouldn't look like a rat's nest of nginx configs"
#
# Traefik is a modern reverse proxy and load balancer for routing HTTP/HTTPS
# and TCP/UDP traffic to your industrial pods. Perfect for edge deployments.
# ============================================================================

# Global settings
global:
  # Check for new versions on startup
  checkNewVersion: true
  # Send anonymous usage statistics
  sendAnonymousUsage: false

# ============================================================================
# DEPLOYMENT CONFIGURATION
# ============================================================================
deployment:
  # Deployment type: Deployment or DaemonSet
  # Deployment: Standard deployment with replica count
  # DaemonSet: One instance per node (recommended for edge)
  kind: "Deployment"
  
  # Number of replicas (ignored if kind: DaemonSet)
  replicas: 1
  
  # Resource preset profiles
  # Options: edge, standard, enterprise, custom
  # edge:       100m-200m CPU, 128Mi-256Mi RAM  - Single node, <50 routes
  # standard:   200m-500m CPU, 256Mi-512Mi RAM  - Multi-node, <200 routes (default)
  # enterprise: 500m-1000m CPU, 512Mi-1Gi RAM   - HA cluster, >200 routes
  # custom:     Use resources section below
  resourcePreset: "standard"
  
  # Custom resources (used when resourcePreset: custom)
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# ============================================================================
# IMAGE CONFIGURATION
# ============================================================================
image:
  repository: traefik
  tag: "3.2.0"
  pullPolicy: IfNotPresent

# ============================================================================
# TRAEFIK CONFIGURATION
# ============================================================================
traefik:
  # Dashboard configuration
  dashboard:
    enabled: true
    # Expose dashboard (set to false for production security)
    expose: true
    # Domain for dashboard (if using ingress)
    domain: "traefik.local"
    # Use basic auth for dashboard
    auth:
      enabled: false
      # Generate with: htpasswd -nb admin password | base64
      # Default: admin/admin
      basic: ""
  
  # API configuration
  api:
    enabled: true
    insecure: false
    dashboard: true
  
  # Metrics for Prometheus
  metrics:
    prometheus:
      enabled: true
      addEntryPointsLabels: true
      addServicesLabels: true
  
  # Access logs
  accessLog:
    enabled: true
    format: "json"
    # Filter HTTP codes (empty = all)
    filters:
      statusCodes: []
      retryAttempts: true
      minDuration: "10ms"
  
  # Traefik logs
  log:
    enabled: true
    level: "INFO"  # DEBUG, INFO, WARN, ERROR
    format: "json"

# ============================================================================
# ENTRYPOINTS (PORTS)
# ============================================================================
# Define how traffic enters Traefik
# ============================================================================
ports:
  # HTTP traffic (web)
  web:
    enabled: true
    port: 80
    exposedPort: 80
    protocol: TCP
    # Redirect HTTP to HTTPS
    redirectTo: ""  # Set to "websecure" to force HTTPS
  
  # HTTPS traffic (websecure)
  websecure:
    enabled: true
    port: 443
    exposedPort: 443
    protocol: TCP
    tls:
      enabled: true
      # TLS options
      options: ""
      certResolver: ""
      domains: []
  
  # Traefik dashboard
  traefik:
    enabled: true
    port: 9000
    exposedPort: 9000
    protocol: TCP
  
  # Prometheus metrics
  metrics:
    enabled: true
    port: 9100
    exposedPort: 9100
    protocol: TCP
  
  # MQTT (TCP)
  mqtt:
    enabled: false
    port: 1883
    exposedPort: 1883
    protocol: TCP
  
  # MQTTS (TLS)
  mqtts:
    enabled: false
    port: 8883
    exposedPort: 8883
    protocol: TCP
  
  # Modbus TCP
  modbus:
    enabled: false
    port: 502
    exposedPort: 502
    protocol: TCP
  
  # OPC-UA
  opcua:
    enabled: false
    port: 4840
    exposedPort: 4840
    protocol: TCP

# ============================================================================
# SERVICE CONFIGURATION
# ============================================================================
service:
  # Service type: ClusterIP, NodePort, LoadBalancer
  type: "LoadBalancer"
  
  # Annotations for cloud provider LoadBalancer
  annotations: {}
    # metallb.universe.tf/address-pool: industrial
    # service.beta.kubernetes.io/aws-load-balancer-type: nlb
  
  # LoadBalancer IP (if supported by cloud provider)
  loadBalancerIP: ""
  
  # External IPs (for on-prem without LoadBalancer)
  externalIPs: []
    # - 192.168.1.100
  
  # NodePort settings (when type: NodePort)
  nodePorts:
    web: 30080
    websecure: 30443
    traefik: 30900

# ============================================================================
# INGRESS CLASS
# ============================================================================
# Configure Traefik as the default ingress controller
# ============================================================================
ingressClass:
  enabled: true
  isDefaultClass: true
  name: "traefik"

# ============================================================================
# TLS / SSL CONFIGURATION
# ============================================================================
tls:
  # Enable TLS
  enabled: true
  
  # Certificate resolvers for Let's Encrypt
  certResolvers:
    letsencrypt:
      enabled: false
      email: "admin@example.com"
      storage: "/data/acme.json"
      # ACME challenge type: tlsChallenge, httpChallenge, dnsChallenge
      challengeType: "tlsChallenge"
      # For HTTP challenge
      httpChallenge:
        entryPoint: "web"
      # For DNS challenge (requires provider)
      dnsChallenge:
        provider: ""  # cloudflare, route53, etc.
        delayBeforeCheck: 30
  
  # Default certificate (self-signed or uploaded)
  defaultCertificate:
    enabled: false
    # Create from existing secret
    secretName: ""
  
  # TLS options
  options:
    default:
      minVersion: "VersionTLS12"
      cipherSuites:
        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305

# ============================================================================
# MIDDLEWARE
# ============================================================================
# Traffic modification and policies
# ============================================================================
middleware:
  # Rate limiting
  rateLimit:
    enabled: false
    average: 100
    burst: 50
  
  # IP whitelisting
  ipWhitelist:
    enabled: false
    sourceRange:
      - 10.0.0.0/8
      - 172.16.0.0/12
      - 192.168.0.0/16
  
  # Basic auth
  basicAuth:
    enabled: false
    users: []
      # - admin:$apr1$...  # htpasswd format
  
  # Headers modification
  headers:
    enabled: true
    sslRedirect: false
    stsSeconds: 31536000
    stsIncludeSubdomains: true
    stsPreload: true
    forceSTSHeader: true
    customRequestHeaders:
      X-Forwarded-Proto: "https"
    customResponseHeaders:
      X-Frame-Options: "SAMEORIGIN"
      X-Content-Type-Options: "nosniff"

# ============================================================================
# PERSISTENCE
# ============================================================================
# For SSL certificates and configurations
# ============================================================================
persistence:
  enabled: true
  
  # Storage class
  storageClass: "local-path"
  
  # Access mode
  accessMode: "ReadWriteOnce"
  
  # Storage size
  size: "1Gi"
  
  # Path where data is stored in container
  path: "/data"
  
  # Existing PVC
  existingClaim: ""

# ============================================================================
# HIGH AVAILABILITY
# ============================================================================
ha:
  enabled: false
  
  # Number of replicas for HA
  replicas: 3
  
  # Pod disruption budget
  podDisruptionBudget:
    enabled: false
    minAvailable: 1
  
  # Pod anti-affinity (spread across nodes)
  affinity:
    enabled: true

# ============================================================================
# SECURITY
# ============================================================================
security:
  # Pod security context
  podSecurityContext:
    fsGroup: 65532
    runAsNonRoot: true
    runAsUser: 65532
  
  # Container security context
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
      add:
        - NET_BIND_SERVICE
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    runAsUser: 65532

# ============================================================================
# NODE PLACEMENT
# ============================================================================
nodeSelector: {}
  # node-role.kubernetes.io/edge: "true"

tolerations: []
  # - key: "edge"
  #   operator: "Equal"
  #   value: "true"
  #   effect: "NoSchedule"

affinity: {}

# ============================================================================
# MONITORING
# ============================================================================
monitoring:
  # Prometheus ServiceMonitor
  serviceMonitor:
    enabled: false
    interval: 30s
    labels:
      release: prometheus
  
  # Grafana dashboard ConfigMap
  grafanaDashboard:
    enabled: false

# ============================================================================
# ADDITIONAL CONFIGURATION
# ============================================================================
# Advanced Traefik configuration via file
# ============================================================================
additionalConfig: {}
  # Example:
  # providers:
  #   file:
  #     directory: /config
  #     watch: true

# Environment variables
env: []
  # - name: CF_API_EMAIL
  #   value: "admin@example.com"
  # - name: CF_API_KEY
  #   valueFrom:
  #     secretKeyRef:
  #       name: cloudflare
  #       key: api-key

# Extra volumes
extraVolumes: []
  # - name: config
  #   configMap:
  #     name: traefik-config

extraVolumeMounts: []
  # - name: config
  #   mountPath: /config

# ============================================================================
# PRESET OVERRIDES
# ============================================================================
presets:
  edge:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  
  standard:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  
  enterprise:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
